<script>
	$(document).ready(function(){
		window.collection.show();
		
		$('#query_builder form select').change(function(e){
			e.preventDefault();
			window.collection.query.type = $(this).val();
		});
		
		$('.property_link').click(function(e){
			window.collection.query.property = $(this).html();
		});
		
		$('#generate_visualization').submit(function(e){
			e.preventDefault();
			window.collection.generate_visualization();
		});
	})
</script>
<section id='collection_pages'>
	<div id='collection_information'>
		<h2><%= title @collection.name %></h2>
		<br>
		<p><%= @collection.description %></p>
	</div>
	<div id='collection_highlights'>
		<% @records = @collection.records.offset(rand((@collection.size).to_i-30)).take(30) %>
		<% @records.each do |r|%>
			<% @record = r %>	
			<%= render 'records/thumb', locals: {record: @record} %>
		<% end %>
	</div>
	<div id='query_builder'>
		<div class='dropper_wrapper'>
			<div class='query_wrapper'>
				<h2 class='query_title'>include</h2>
				<div id='query_include'></div>
			</div>
			<div class='query_wrapper'>
				<h2 class='query_title'>exclude</h2>
				<div id='query_exclude'></div>
			</div>
		</div>
		<div id='visualization_options'>
			<form id='generate_visualization' >
				<label for='record_count'>Records:</label>
				<input id='record_count' type="number" value='<%= (@collection.size).to_i %>' readonly>
				<select id='vizualization_mode'>
					<option selected disabled>Choose Vizualization</option>
					<option value='treemap'>Treemap</option>
					<option value='thumbnail'>Thumbnail</option>
				</select>
				<input type='submit' value='generate visualization'>
			</form>
		</div>
		<div id='properties_menu'>
			<div id='properties_header'>
				<% @collection.properties.each do |property, values| %>
				<% if ['thumbnail','image'].include? property
					next
				end%>
				<a id='<%=property%>_list' class='property_link'><%=property%></a>
				<% end %>
				<br>
				<label for='filter'>filter</label>
				<input id='filter'>
			</div>
			<div id='collection_properties'>
				<div id='property_list' class='property_wrapper'>
					<ul  class='property_list' data-property=''>
					
					</ul>
				</div>
			</div>
		</div>
	</div>
</section>