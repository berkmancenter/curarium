<script>
	$(document).ready(function(){
		window.collection.query_builder();
		
		$('#query_builder form select').change(function(e){
			e.preventDefault();
			window.collection.query.visualization = $(this).val();
		});
		
		$('.property_link').click(function(e){
			window.collection.query.property = $(this).html();
		});
		
		$('#collection_header select').change(function(e){
			location = $(this).val();
		});
		
		$('#query_builder form').submit(function(e){
			e.preventDefault();
			window.collection.generate_visualization();
		});
	})
</script>
<div id='collection_header'>
	<h1><%= @collection.name %></h1>
	<select>
		<option value='#collection_info'>ABOUT</option>
		<option value='#query_builder'>EXPLORE</option>
	</select>
</div>
<section id='collection_pages'>
	<div id='collection_info'>
		<p><%= @collection.description %></p>
	</div>
	<div id='query_builder'>
		<div class='dropper_wrapper'>
			<div class='query_wrapper'>
				<h2 class='query_title'>include</h2>
				<div id='query_include'></div>
			</div>
			<div class='query_wrapper'>
				<h2 class='query_title'>exclude</h2>
				<div id='query_exclude'></div>
			</div>
		</div>
		<div id='properties_menu'>
			<div id='properties_header'>
					<% @collection.properties.each do |property, values| %>
					<% if ['thumbnail','image'].include? property
						next
					end%>
					<a href='#<%=property%>_list' class='property_link'><%=property%></a>
					<% end %>
					<br>
					<label for='filter'>filter</label>
					<input id='filter'>
				</div>
			<div id='collection_properties'>
			<% @collection.properties.each do |property, values| %>
				<% if ['thumbnail','image'].include? property
					next
				end%>
				<div id='<%=property%>_list' class='property_wrapper'>
					<ul  class='property_list' data-property='<%=property%>'>
					<% values.each do |value, count| %>
						<li data-value='<%=value%>'><%= value %> (<%=count%>)</li>
					<% end %>
					</ul>
				</div>
			<% end %>
			</div>
		</div>
		<div id='visualization_options'>
			<form>
				<label for='record_count'>Records:</label>
				<input id='record_count' type="number" value='<%= @collection.records.length %>' readonly>
				<select id='vizualization_mode'>
					<option selected disabled>Choose Vizualization</option>
					<option value='treemap'>Treemap</option>
					<option value='thumbnail'>Thumbnail</option>
				</select>
				<input type='submit' value='generate visualization'>
			</form>
		</div>
	</div>
</section>