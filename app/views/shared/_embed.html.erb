

<% container_id = "cont_"+SecureRandom.hex(4) %>

<% visualization ||= nil %>

<% unless visualization.nil?
		type = visualization[:type]
		url = visualization[:url]
 end %>

<% if visualization.nil? and !params[:type].nil?%>
	
	<%= javascript_include_tag "http://code.jquery.com/jquery-2.1.0.min.js" %>
	<%= javascript_include_tag "http://cdnjs.cloudflare.com/ajax/libs/d3/3.4.2/d3.min.js" %>
	<%= javascript_include_tag  URI.parse(root_url).merge(javascript_path("visualizations")) %>
	
		<% current = request.original_url.split('?')%>
		<% type = params[:type]%>
		<% url = "http://#{request.host}:#{request.port}/collections/#{params[:collection]}/visualizations?#{current[1]}"%>
		
		<style type="text/css">
			.visualization_component {
				margin: 0;
				padding: 0;
				width: 100%;
				height: 100%;
			}
			
			.node {
			  box-sizing: border-box;
			  font: 10px sans-serif;
			  color: black;
			  line-height: 12px;
			  overflow: hidden !important;
			  position: absolute;
			  text-indent: 2px;
			}
			
		</style>
<% end %>

<% if visualization.nil? and params[:type].nil?
		type = ''
		url = ''
end %>

<script type="text/javascript">
	window.visualization['<%= type+'_embedded'%>']('<%=container_id%>', "<%= url %>");
</script>

<div id='<%=container_id%>' class='visualization_component' >
	
</div>
